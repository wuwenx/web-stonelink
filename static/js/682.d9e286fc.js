"use strict";(self["webpackChunkweb_stonelink"]=self["webpackChunkweb_stonelink"]||[]).push([[682],{3682:function(e,a,l){l.r(a),l.d(a,{default:function(){return P}});l(600);var t=l(1140),r=l(2780),s=l(3853),o=l(7485),n=l(1903),c=l(4446);const i={class:"symbol-detail-container"},u={class:"card-header"},d={class:"header-left"},b={class:"page-title"},p={class:"header-right"},v={class:"control-group"},g={class:"control-group"},k={class:"slippage-controls"},h={class:"input-group"},f={class:"input-label"},y={class:"price-text"},_={class:"price-text"},F={class:"status-item"},m={class:"status-icon"},w={class:"status-content"},S={class:"status-title"};var L={__name:"SymbolDetail",setup(e){const a=(0,n.lq)(),l=(0,n.rd)(),L=(0,c.Jd)(),C=(0,c.Py)(),x=(0,c.AM)(),P=(0,r.KR)(""),D=(0,r.KR)(""),W=(0,r.KR)("buy"),A=(0,r.KR)(!1),B=(0,r.KR)(!1),K=(0,r.KR)("--"),T=(0,r.KR)([]),R=(0,r.KR)(1),z=(0,r.KR)([]),E=(0,r.KR)(!1),U=(0,r.KR)([{label:"BTCUSDT",value:"BTCUSDT"},{label:"ETHUSDT",value:"ETHUSDT"}]),V=[{label:"万1(0.01%)",value:"0.01"},{label:"万5(0.05%)",value:"0.05"},{label:"微观(0.1%)",value:"0.1"},{label:"紧密(0.5%)",value:"0.5"},{label:"核心(1%)",value:"1"},{label:"巨额(2%)",value:"2"},{label:"大额(5%)",value:"5"},{label:"极限(10%)",value:"10"}],X=["Binance","Toobit"],$=(e,a)=>{let l;switch(e.toLowerCase()){case"binance":l=L.getDepthDataBySymbol(a);break;case"okx":l=C.getDepthDataBySymbol(a);break;case"toobit":l=x.getDepthDataBySymbol(a);break;default:return{spread:0,spreadPercent:0}}if(!l||!l.bestBid||!l.bestAsk)return{spread:0,spreadPercent:0};const t=l.bestAsk-l.bestBid,r=t/l.bestBid*100;return{spread:t,spreadPercent:r}},I=(e,a,l)=>{let t;switch(e.toLowerCase()){case"binance":t=L.getDepthDataBySymbol(a);break;case"okx":t=C.getDepthDataBySymbol(a);break;case"toobit":t=x.getDepthDataBySymbol(a);break;default:return 0}if(!t)return 0;const r=parseFloat(l)/100;return"buy"===W.value?q(t.bids,t.bestBid,r):"sell"===W.value?M(t.asks,t.bestAsk,r):void 0},q=(e,a,l)=>{if(!e||0===e.length||!a||0===a)return 0;const t=a*(1-l);let r=0;for(const s of e)s.price<=a&&s.price>=t&&(r+=s.quantity);return r},M=(e,a,l)=>{if(!e||0===e.length||!a||0===a)return 0;const t=a*(1+l);let r=0;for(const s of e)s.price>=a&&s.price<=t&&(r+=s.quantity);return r},H=()=>{const e=[];X.forEach(a=>{const l={exchange:a,...$(a.toLowerCase(),P.value)};V.forEach(e=>{const t=I(a.toLowerCase(),P.value,e.value);l[`depth_${e.value}`]=t}),e.push(l)}),T.value=e,K.value=(new Date).toLocaleTimeString()},J=()=>{if(R.value&&!(R.value<=0)){E.value=!0;try{const e=[],a=["binance","toobit"];a.forEach(a=>{const l=N(a,P.value);if(l){const t=O(l.asks,R.value,"buy"),r=O(l.bids,R.value,"sell");e.push({exchange:a,buySlippage:t.slippagePercent,sellSlippage:r.slippagePercent,buyAvgPrice:t.averagePrice,sellAvgPrice:r.averagePrice})}else e.push({exchange:a,buySlippage:0,sellSlippage:0,buyAvgPrice:0,sellAvgPrice:0})}),z.value=e}catch(e){console.error("滑点计算错误:",e)}finally{E.value=!1}}},N=(e,a)=>{switch(e.toLowerCase()){case"binance":return L.getDepthDataBySymbol(a);case"toobit":return x.getDepthDataBySymbol(a);default:return null}},O=(e,a,l)=>{if(!e||0===e.length)return{slippagePercent:0,averagePrice:0,startPrice:0,finalPrice:0};const t=e[0].price;let r=0,s=0,o=a,n=t;for(const u of e){if(o<=0)break;const e=u.price,a=u.quantity,l=Math.min(o,a);r+=l*e,s+=l,o-=l,n=e}o>0&&console.warn(`警告: 市场深度不足! 尚有 ${o.toFixed(2)} 未成交`);const c=s>0?r/s:t,i=(c-t)/t*100;return{slippagePercent:i,averagePrice:c,startPrice:t,finalPrice:n}},j=async()=>{B.value=!0;try{await Promise.all([L.reconnectWebSockets(),C.reconnectWebSockets(),x.reconnectWebSockets()]),H()}catch(e){console.error("刷新数据失败:",e)}finally{B.value=!1}},G=()=>{l.go(-1)},Q=e=>{P.value=e,D.value=e,H()},Y=e=>{W.value=e,H()},Z=e=>{const a={Binance:"success",OKX:"warning",Toobit:"primary"};return a[e]||"info"},ee=e=>e<.05?"success":e<.1?"warning":"danger",ae=(e,a)=>{const l=parseFloat(a),t=1e3*l;return e>2*t?"success":e>t?"warning":"danger"},le=e=>e&&0!==e?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toFixed(1):"--",te=e=>e&&0!==e?`${e.toFixed(4)} %`:"0.0000 %",re=e=>e&&0!==e?e.toFixed(2):"--",se=e=>e<.05?"success":e<.1?"warning":"danger",oe=({row:e,column:a,rowIndex:l,columnIndex:t})=>0===t?{backgroundColor:"var(--el-fill-color-light)",fontWeight:"bold"}:{},ne=()=>({backgroundColor:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)",fontWeight:"bold",textAlign:"center"}),ce=e=>{let a;switch(e.toLowerCase()){case"binance":a=L;break;case"okx":a=C;break;case"toobit":a=x;break;default:return"disconnected"}return a.getConnectionStatus(P.value)},ie=e=>{const a=ce(e),l={connected:"已连接",connecting:"连接中",error:"错误",disconnected:"未连接"};return l[a]||"未知"},ue=e=>{const a=ce(e),l={connected:"#67C23A",connecting:"#E6A23C",error:"#F56C6C",disconnected:"#909399"};return l[a]||"#909399"},de=e=>{const a=ue(e);return{color:a,fontSize:"14px",fontWeight:"bold"}},be=e=>{const a=ce(e),l={connected:o.CircleCheck,connecting:o.Connection,error:o.CircleClose,disconnected:o.Warning};return l[a]||o.Warning};return(0,t.sV)(()=>{P.value=a.params.symbol||"BTCUSDT",D.value=P.value,console.log("SymbolDetail页面已挂载，WebSocket连接由SimpleLayout管理"),H(),J();const e=setInterval(H,1e3);(0,t.hi)(()=>{clearInterval(e),console.log("SymbolDetail页面已卸载，保持WebSocket连接")})}),(e,a)=>{const l=(0,t.g2)("el-button"),n=(0,t.g2)("el-tag"),c=(0,t.g2)("el-card"),L=(0,t.g2)("el-option"),C=(0,t.g2)("el-select"),x=(0,t.g2)("el-col"),$=(0,t.g2)("el-radio-button"),I=(0,t.g2)("el-radio-group"),q=(0,t.g2)("el-row"),M=(0,t.g2)("el-input-number"),H=(0,t.g2)("el-table-column"),N=(0,t.g2)("el-table"),O=(0,t.g2)("el-icon"),ce=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",i,[(0,t.bF)(c,{class:"header-card",shadow:"hover"},{header:(0,t.k6)(()=>[(0,t.Lk)("div",u,[(0,t.Lk)("div",d,[(0,t.bF)(l,{type:"primary",icon:(0,r.R1)(o.ArrowLeft),size:"small",onClick:G},{default:(0,t.k6)(()=>[...a[3]||(a[3]=[(0,t.eW)(" 返回 ",-1)])]),_:1},8,["icon"]),(0,t.Lk)("h2",b,(0,s.v_)(P.value)+" 单币对详情 ",1)]),(0,t.Lk)("div",p,[(0,t.bF)(n,{type:"info",size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)(" 更新时间: "+(0,s.v_)(K.value),1)]),_:1}),(0,t.bF)(l,{type:"primary",icon:(0,r.R1)(o.Refresh),loading:B.value,size:"small",onClick:j},{default:(0,t.k6)(()=>[...a[4]||(a[4]=[(0,t.eW)(" 刷新 ",-1)])]),_:1},8,["icon","loading"])])])]),_:1}),(0,t.bF)(c,{class:"control-card",shadow:"hover"},{header:(0,t.k6)(()=>[...a[5]||(a[5]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",{class:"card-title"},"控制面板")],-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(q,{gutter:20},{default:(0,t.k6)(()=>[(0,t.bF)(x,{span:12},{default:(0,t.k6)(()=>[(0,t.Lk)("div",v,[a[6]||(a[6]=(0,t.Lk)("label",{class:"control-label"},"交易对",-1)),(0,t.bF)(C,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e),placeholder:"选择交易对",onChange:Q},{default:(0,t.k6)(()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(U.value,e=>((0,t.uX)(),(0,t.Wv)(L,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),(0,t.bF)(x,{span:12},{default:(0,t.k6)(()=>[(0,t.Lk)("div",g,[a[9]||(a[9]=(0,t.Lk)("label",{class:"control-label"},"订单方向",-1)),(0,t.bF)(I,{modelValue:W.value,"onUpdate:modelValue":a[1]||(a[1]=e=>W.value=e),onChange:Y},{default:(0,t.k6)(()=>[(0,t.bF)($,{label:"buy"},{default:(0,t.k6)(()=>[...a[7]||(a[7]=[(0,t.eW)(" 买盘 ",-1)])]),_:1}),(0,t.bF)($,{label:"sell"},{default:(0,t.k6)(()=>[...a[8]||(a[8]=[(0,t.eW)(" 卖盘 ",-1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1}),(0,t.bF)(c,{class:"slippage-card",shadow:"hover"},{header:(0,t.k6)(()=>[...a[10]||(a[10]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",{class:"card-title"},"滑点模拟")],-1)])]),default:(0,t.k6)(()=>[(0,t.Lk)("div",k,[(0,t.Lk)("div",h,[(0,t.Lk)("label",f,"模拟交易数量 ("+(0,s.v_)(P.value.replace("USDT",""))+")",1),(0,t.bF)(M,{modelValue:R.value,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value=e),min:.001,max:1e3,precision:3,step:.1,size:"large",onChange:J},null,8,["modelValue"])]),(0,t.bF)(l,{type:"primary",size:"large",onClick:J},{default:(0,t.k6)(()=>[...a[11]||(a[11]=[(0,t.eW)(" 计算滑点 ",-1)])]),_:1})]),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(N,{data:z.value,stripe:"",border:"",class:"slippage-table"},{default:(0,t.k6)(()=>[(0,t.bF)(H,{prop:"exchange",label:"交易所",width:"120",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(n,{type:Z(e.exchange),size:"large"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(e.exchange.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(H,{prop:"buySlippage",label:"买入滑点",width:"200",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(n,{type:se(e.buySlippage),size:"large"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(te(e.buySlippage)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(H,{prop:"sellSlippage",label:"卖出滑点",width:"200",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(n,{type:se(e.sellSlippage),size:"large"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(te(e.sellSlippage)),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(H,{prop:"buyAvgPrice",label:"买入均价",width:"150",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("span",y,(0,s.v_)(re(e.buyAvgPrice)),1)]),_:1}),(0,t.bF)(H,{prop:"sellAvgPrice",label:"卖出均价",width:"150",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.Lk)("span",_,(0,s.v_)(re(e.sellAvgPrice)),1)]),_:1})]),_:1},8,["data"])),[[ce,E.value]])]),_:1}),(0,t.bF)(c,{class:"table-card",shadow:"hover"},{header:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",{class:"card-title"},"流动性数据")],-1)])]),default:(0,t.k6)(()=>[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(N,{data:T.value,stripe:"",border:"",class:"liquidity-table","cell-style":oe,"header-cell-style":ne},{default:(0,t.k6)(()=>[(0,t.bF)(H,{prop:"exchange",label:"交易所",width:"150",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(n,{type:Z(e.exchange),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(e.exchange),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(H,{prop:"spread",label:"价差%",width:"120",align:"center"},{default:(0,t.k6)(({row:e})=>[(0,t.bF)(n,{type:ee(e.spreadPercent),size:"small",effect:"dark"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(e.spreadPercent.toFixed(4))+"% ",1)]),_:2},1032,["type"])]),_:1}),((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(V,e=>(0,t.bF)(H,{key:e.value,prop:`depth_${e.value}`,label:e.label,width:"140",align:"center"},{default:(0,t.k6)(({row:a})=>[(0,t.bF)(n,{type:ae(a[`depth_${e.value}`],e.value),size:"small"},{default:(0,t.k6)(()=>[(0,t.eW)((0,s.v_)(le(a[`depth_${e.value}`])),1)]),_:2},1032,["type"])]),_:2},1032,["prop","label"])),64))]),_:1},8,["data"])),[[ce,A.value]])]),_:1}),(0,t.bF)(c,{class:"status-card",shadow:"hover"},{header:(0,t.k6)(()=>[...a[13]||(a[13]=[(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("span",{class:"card-title"},"连接状态")],-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(q,{gutter:20},{default:(0,t.k6)(()=>[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(X,e=>(0,t.bF)(x,{key:e,span:6},{default:(0,t.k6)(()=>[(0,t.Lk)("div",F,[(0,t.Lk)("div",m,[(0,t.bF)(O,{color:ue(e),size:"20"},{default:(0,t.k6)(()=>[((0,t.uX)(),(0,t.Wv)((0,t.$y)(be(e))))]),_:2},1032,["color"])]),(0,t.Lk)("div",w,[(0,t.Lk)("div",S,(0,s.v_)(e),1),(0,t.Lk)("div",{class:"status-value",style:(0,s.Tr)(de(e))},(0,s.v_)(ie(e)),5)])])]),_:2},1024)),64))]),_:1})]),_:1})])}}},C=l(8680);const x=(0,C.A)(L,[["__scopeId","data-v-5f7201f2"]]);var P=x}}]);