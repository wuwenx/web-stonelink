"use strict";(self["webpackChunkweb_stonelink"]=self["webpackChunkweb_stonelink"]||[]).push([[909],{909:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});a(6175),a(9865),a(6068),a(1397),a(343),a(6699),a(3754),a(3383),a(7133),a(5284),a(5595),a(4096),a(7858);var s=a(587),n=a(2651),r=a(8674),l=a(3209),i=a(415),o=a(3291),c=a(5793),u=a(3470);function p(e={}){const{exchange:t="toobit",type:a}=e,s=`${c.JR}/ticker/24hr`,n={exchange:t};return"spot"===a&&(n.type="spot"),(0,u.A)({url:s,method:"get",params:n,timeout:15e3}).then(e=>{const t=e.data;if(200!==t.code)throw new Error(t.message||"获取24hr行情失败");return t.data||[]}).catch(e=>{if(e.response)throw new Error(e.response.data?.message||"获取24hr行情失败");if(e.request)throw new Error("网络错误，请检查后端服务是否启动");throw e})}function d(e={}){const{exchange:t="toobit",type:a="contract",limit:s=10}=e,n=`${c.JR}/ticker/rankings`;return(0,u.A)({url:n,method:"get",params:{exchange:t,type:a,limit:s},timeout:15e3}).then(e=>{const t=e.data;if(200!==t.code)throw new Error(t.message||"获取排行失败");const a=t.data||{};return{gainers:a.gainers||[],losers:a.losers||[],by_volume:a.by_volume||[]}}).catch(e=>{if(e.response)throw new Error(e.response.data?.message||"获取排行失败");if(e.request)throw new Error("网络错误，请检查后端服务是否启动");throw e})}var m=a(5850),k=a(1569),v=a(6329);const g={class:"market-page"},h={class:"card-header"},b={class:"header-left"},f={class:"card-header rankings-card-header"},y={class:"exchange-label"},_={class:"rankings-grid"},w={class:"rank-column"},x={class:"rank-list"},L={class:"rank-pcp up"},F={key:0,class:"rank-item empty"},E={class:"rank-column"},C={class:"rank-list"},W={class:"rank-pcp down"},A={key:0,class:"rank-item empty"},S={class:"rank-column"},X={class:"rank-list"},N={class:"rank-price"},R={class:"rank-qv"},T={key:0,class:"rank-item empty"},$={class:"num-text"},q={class:"num-text up"},K={class:"num-text down"},U={class:"num-text"},I={class:"num-text"},z={class:"pagination-wrap"},M={class:"card-header heatmap-card-header"},O={class:"exchange-label"},D={class:"heatmap-wrap"},Q={class:"heatmap-symbol"},B={class:"heatmap-pcp"},P={key:0,class:"empty-tip"},J="toobit",V=60;var Z={__name:"Market",setup(e){const t=(0,m.w)(),a=(0,k.j)(),c=(0,v.V)(),u=(0,s.EW)(()=>"futures"===t.config.exchangeType?"contract":"spot"),Z=(0,n.KR)(1),j=(0,n.KR)(20),H=(0,n.KR)([]),G=(0,n.KR)(0),Y=(0,n.KR)(!1),ee=(0,s.EW)(()=>Y.value),te=(0,n.KR)({gainers:[],losers:[],by_volume:[]}),ae=(0,n.KR)(!1);let se=!0;async function ne(){se&&(ae.value=!0,se=!1);try{const e=await d({exchange:J,type:u.value,limit:20});te.value=e}catch(e){te.value={gainers:[],losers:[],by_volume:[]}}finally{ae.value=!1}}function re(e){if(!e)return"";const t=String(e).match(/^([A-Z0-9-]+)-SWAP-([A-Z]+)$/i);return t?`${t[1]}${t[2]}`:e.replace(/-/g,"")}function le(e){if(!e||"string"!==typeof e)return"";const t=String(e).toUpperCase().trim();if(t.includes("-SWAP-"))return t.split("-SWAP-")[0].trim()||"";const a=t.split(":")[0].trim(),s=a.indexOf("/");return s>0?a.slice(0,s).trim():a}const ie=(0,s.EW)(()=>{const e=te.value.gainers||[],t=te.value.losers||[],a=[...e.map(e=>({s:e.s,base:le(e.s),pcp:e.pcp,pcpNum:Number(e.pcp)})),...t.map(e=>({s:e.s,base:le(e.s),pcp:e.pcp,pcpNum:Number(e.pcp)}))],s=new Set,n=a.filter(e=>{const t=e.base||e.s;return!(!t||s.has(t))&&(s.add(t),!0)});return n.sort((e,t)=>Math.abs(t.pcpNum)-Math.abs(e.pcpNum)).slice(0,V)}),oe=(0,s.EW)(()=>{const e=ie.value;return e.length?Math.max(...e.map(e=>Math.abs(e.pcpNum)),1e-4):1});function ce(e){const t=Math.abs(e.pcpNum),a=oe.value>0?t/oe.value:0,s=72,n=128,r=Math.round(s+a*(n-s));return{width:`${r}px`,minHeight:`${r}px`}}async function ue(){Y.value=!0;try{const e=await(0,o.X)({exchange:J,market_type:u.value,page:Z.value,page_size:j.value});return H.value=e.items||[],G.value=e.total??0,H.value}catch(e){return H.value=[],G.value=0,[]}finally{Y.value=!1}}async function pe(){try{const e=await p({exchange:J,type:"contract"===u.value?void 0:"spot"});a.setInitialTickersFrom24hr(Array.isArray(e)?e:[])}catch(e){a.setInitialTickersFrom24hr([])}}function de(){const e=H.value||[];return e.map(e=>e.symbol||e.id).filter(Boolean)}function me(e){const t=(0,i.dE)((e.id||e.symbol||"").toUpperCase()),s=(a.tickerList||[]).find(a=>(0,i.dE)((a.s||"").toUpperCase())===t||(a.s||"").toUpperCase()===(e.id||"").toUpperCase());return s?{...e,...s}:{...e}}const ke=(0,s.EW)(()=>{const e=c.getSymbolsByExchangeAndType(J,u.value)||[],t=new Map;for(const a of e){const e=(0,i.dE)(String(a.symbol||a.id||"").toUpperCase());t.set(e,{min_price:a.min_price,min_qty:a.min_qty})}return t}),ve=(0,s.EW)(()=>{const e=H.value||[],t=e.map(e=>me(e));return[...t].sort((e,t)=>{const a=new l.A(t.qv||0),s=new l.A(e.qv||0);return a.comparedTo(s)})});function ge(e){const t=e.symbol||e.id||e.s||"",a=(0,i.dE)(String(t).toUpperCase());return ke.value.get(a)||{}}function he(e){return null==e||"string"!==typeof e?e:e.replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}function be(e){if(null==e||""===e)return null;const t=new l.A(e);if(!t.isFinite()||t.lte(0))return null;if(t.gte(1))return 0;const a=t.toFixed(),s=a.indexOf(".");return-1===s?0:a.length-s-1}function fe(e,t){if(null==e||""===e||void 0===e)return"--";const a=new l.A(e);if(!a.isFinite())return String(e);const s=null!=t&&""!==t?be(t):null;if(a.gte(1e8))return he(a.div(1e8).toFixed(2))+"亿";if(a.gte(1e4))return he(null!=s?a.toFixed(s):a.toFormat(4,l.A.ROUND_DOWN));const n=null!=s?s:8;return he(a.toFormat(n,l.A.ROUND_DOWN,{groupSeparator:",",decimalSeparator:"."}))}function ye(e,t){if(null==e||""===e||void 0===e)return"--";const a=new l.A(e);if(!a.isFinite())return String(e);const s=null!=t&&""!==t?be(t):null;return a.gte(1e8)?he(a.div(1e8).toFixed(2))+"亿":a.gte(1e4)?he(a.div(1e4).toFixed(null!=s?s:2))+"万":he(a.toFormat(null!=s?s:4,l.A.ROUND_DOWN,{groupSeparator:",",decimalSeparator:"."}))}function _e(e){if(null==e||""===e||void 0===e)return"--";const t=new l.A(e);if(!t.isFinite())return String(e);const a=he(t.times(100).toFixed(2));return(t.gte(0)?"+":"")+a+"%"}function we(e){if(null==e||""===e||void 0===e)return"--";const t=new l.A(e);if(!t.isFinite())return String(e);const a=he(t.times(100).toFixed(2));return(t.gte(0)?"+":"")+a+"%"}const xe={color:"#00ff88",fontWeight:600},Le={color:"#ff4757",fontWeight:600},Fe={},Ee={padding:"2px 6px",borderRadius:"4px",color:"#00ff88",backgroundColor:"rgba(0, 255, 136, 0.08)"},Ce={padding:"2px 6px",borderRadius:"4px",color:"#ff4757",backgroundColor:"rgba(255, 71, 87, 0.08)"},We={padding:"2px 6px",borderRadius:"4px"};function Ae(e){const t=Number(e.pcp);return t>0?xe:t<0?Le:Fe}function Se(e){const t=Number(e.pcp);return t>0?Ee:t<0?Ce:We}function Xe(e){Z.value=e,ue().then(()=>{a.updateTickerSymbols(de())})}function Ne(e){j.value=e,Z.value=1,ue().then(()=>{a.updateTickerSymbols(de())})}let Re=null;return(0,s.sV)(async()=>{ne(),await ue(),await pe(),a.startTickers(J,u.value,de()),Re=setInterval(ne,1e4)}),(0,s.wB)(()=>t.config.exchangeType,async()=>{Z.value=1,ne(),await ue(),await pe(),a.startTickers(J,u.value,de())}),(0,s.hi)(()=>{Re&&(clearInterval(Re),Re=null),a.stopWs()}),(e,t)=>{const l=(0,s.g2)("el-tag"),i=(0,s.g2)("el-card"),o=(0,s.g2)("router-link"),c=(0,s.g2)("el-table-column"),p=(0,s.g2)("el-table"),d=(0,s.g2)("el-pagination"),m=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",g,[(0,s.bF)(i,{class:"header-card",shadow:"hover"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",h,[(0,s.Lk)("div",b,[t[2]||(t[2]=(0,s.Lk)("h1",{class:"page-title"}," 市场行情 ",-1)),"connected"===(0,n.R1)(a).wsStatus?((0,s.uX)(),(0,s.Wv)(l,{key:0,type:"success",size:"small"},{default:(0,s.k6)(()=>[...t[0]||(t[0]=[(0,s.eW)(" 实时 ",-1)])]),_:1})):((0,s.uX)(),(0,s.Wv)(l,{key:1,type:"info",size:"small"},{default:(0,s.k6)(()=>[...t[1]||(t[1]=[(0,s.eW)(" 已断开 ",-1)])]),_:1}))])])]),_:1}),(0,s.bF)(i,{class:"rankings-card",shadow:"hover"},{header:(0,s.k6)(()=>[(0,s.Lk)("div",f,[t[3]||(t[3]=(0,s.Lk)("span",{class:"card-title"},"排行",-1)),(0,s.Lk)("span",y,"交易所: toobit · "+(0,r.v_)("contract"===u.value?"合约":"现货"),1)])]),default:(0,s.k6)(()=>[(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("div",w,[t[4]||(t[4]=(0,s.Lk)("h4",{class:"rank-title gainers-title"},"涨幅榜",-1)),(0,s.Lk)("ul",x,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value.gainers.slice(0,5),(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:e.s+t,class:"rank-item"},[(0,s.bF)(o,{to:`/symbol/${re(e.s)}`,class:"rank-symbol"},{default:(0,s.k6)(()=>[(0,s.eW)((0,r.v_)(e.s),1)]),_:2},1032,["to"]),(0,s.Lk)("span",{class:"rank-price",style:(0,r.Tr)(Ae(e))},(0,r.v_)(fe(e.c,ge(e).min_price)),5),(0,s.Lk)("span",L,(0,r.v_)(we(e.pcp)),1)]))),128)),te.value.gainers.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("li",F,"暂无"))])]),(0,s.Lk)("div",E,[t[5]||(t[5]=(0,s.Lk)("h4",{class:"rank-title losers-title"},"跌幅榜",-1)),(0,s.Lk)("ul",C,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value.losers.slice(0,5),(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:e.s+t,class:"rank-item"},[(0,s.bF)(o,{to:`/symbol/${re(e.s)}`,class:"rank-symbol"},{default:(0,s.k6)(()=>[(0,s.eW)((0,r.v_)(e.s),1)]),_:2},1032,["to"]),(0,s.Lk)("span",{class:"rank-price",style:(0,r.Tr)(Ae(e))},(0,r.v_)(fe(e.c,ge(e).min_price)),5),(0,s.Lk)("span",W,(0,r.v_)(we(e.pcp)),1)]))),128)),te.value.losers.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("li",A,"暂无"))])]),(0,s.Lk)("div",S,[t[6]||(t[6]=(0,s.Lk)("h4",{class:"rank-title volume-title"},"成交额榜",-1)),(0,s.Lk)("ul",X,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value.by_volume.slice(0,5),(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:e.s+t,class:"rank-item"},[(0,s.bF)(o,{to:`/symbol/${re(e.s)}`,class:"rank-symbol"},{default:(0,s.k6)(()=>[(0,s.eW)((0,r.v_)(e.s),1)]),_:2},1032,["to"]),(0,s.Lk)("span",N,(0,r.v_)(fe(e.c,ge(e).min_price)),1),(0,s.Lk)("span",R,(0,r.v_)(ye(e.qv,ge(e).min_qty)),1)]))),128)),te.value.by_volume.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("li",T,"暂无"))])])])),[[m,ae.value]])]),_:1}),(0,s.bF)(i,{class:"table-card",shadow:"hover"},{header:(0,s.k6)(()=>[...t[7]||(t[7]=[(0,s.Lk)("div",{class:"card-header table-card-header"},[(0,s.Lk)("div",{class:"table-header-left"},[(0,s.Lk)("span",{class:"card-title"},"24h 行情"),(0,s.Lk)("span",{class:"exchange-label"},"交易所: toobit")])],-1)])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",{class:(0,r.C4)(["table-wrap",{loading:ee.value}])},[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(p,{data:ve.value,stripe:"",border:"",class:"market-table","empty-text":"暂无数据"},{default:(0,s.k6)(()=>[(0,s.bF)(c,{label:"交易对","min-width":"140",fixed:""},{default:(0,s.k6)(({row:e})=>[(0,s.bF)(o,{to:`/symbol/${e.id}`,class:"symbol-link"},{default:(0,s.k6)(()=>[(0,s.eW)((0,r.v_)(e.id||e.symbol),1)]),_:2},1032,["to"])]),_:1}),(0,s.bF)(c,{prop:"c",label:"最新价","min-width":"120",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",{class:"num-text",style:(0,r.Tr)(Ae(e))},(0,r.v_)(fe(e.c,ge(e).min_price)),5)]),_:1}),(0,s.bF)(c,{prop:"o",label:"开盘价","min-width":"110",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",$,(0,r.v_)(fe(e.o,ge(e).min_price)),1)]),_:1}),(0,s.bF)(c,{prop:"h",label:"最高价","min-width":"110",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",q,(0,r.v_)(fe(e.h,ge(e).min_price)),1)]),_:1}),(0,s.bF)(c,{prop:"l",label:"最低价","min-width":"110",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",K,(0,r.v_)(fe(e.l,ge(e).min_price)),1)]),_:1}),(0,s.bF)(c,{prop:"v",label:"成交量","min-width":"120",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",U,(0,r.v_)(ye(e.v,ge(e).min_qty)),1)]),_:1}),(0,s.bF)(c,{prop:"qv",label:"成交额","min-width":"120",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",I,(0,r.v_)(ye(e.qv,ge(e).min_qty)),1)]),_:1}),(0,s.bF)(c,{prop:"pc",label:"涨跌额","min-width":"100",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",{class:"num-text",style:(0,r.Tr)(Ae(e))},(0,r.v_)(fe(e.pc,ge(e).min_price)),5)]),_:1}),(0,s.bF)(c,{prop:"pcp",label:"涨跌幅","min-width":"100",align:"right",sortable:""},{default:(0,s.k6)(({row:e})=>[(0,s.Lk)("span",{class:"num-text pcp-cell",style:(0,r.Tr)(Se(e))},(0,r.v_)(_e(e.pcp)),5)]),_:1})]),_:1},8,["data"])),[[m,ee.value]]),(0,s.Lk)("div",z,[(0,s.bF)(d,{"current-page":Z.value,"page-size":j.value,"page-sizes":[10,20,50,100],total:G.value,layout:"total, sizes, prev, pager, next",background:"",onCurrentChange:Xe,onSizeChange:Ne},null,8,["current-page","page-size","total"])])],2)]),_:1}),(0,s.bF)(i,{class:"heatmap-card",shadow:"hover"},{header:(0,s.k6)(()=>[(0,s.Lk)("div",M,[t[8]||(t[8]=(0,s.Lk)("span",{class:"card-title"},"涨跌幅热力图",-1)),(0,s.Lk)("span",O,"交易所: toobit · "+(0,r.v_)("contract"===u.value?"合约":"现货"),1)])]),default:(0,s.k6)(()=>[(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",D,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ie.value,e=>((0,s.uX)(),(0,s.Wv)(o,{key:e.s,to:`/symbol/${re(e.s)}`,class:(0,r.C4)(["heatmap-block",e.pcpNum>=0?"up":"down"]),style:(0,r.Tr)(ce(e))},{default:(0,s.k6)(()=>[(0,s.Lk)("span",Q,(0,r.v_)(e.base),1),(0,s.Lk)("span",B,(0,r.v_)(we(e.pcp)),1)]),_:2},1032,["to","class","style"]))),128))])),[[m,ae.value]]),ae.value||0!==ie.value.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",P," 暂无数据 "))]),_:1})])}}},j=a(9190);const H=(0,j.A)(Z,[["__scopeId","data-v-68983973"]]);var G=H}}]);